{"version":3,"file":"Artalk.js","sources":["../../../src/client/components/Artalk.ts"],"sourcesContent":["import { isString } from \"@vuepress/helper/client\";\nimport type Artalk from \"artalk\";\nimport type { VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n} from \"vue\";\nimport { usePageData, useSiteData } from \"vuepress/client\";\nimport { LoadingIcon } from \"vuepress-shared/client\";\n\nimport { useArtalkOptions } from \"../helpers/index.js\";\n\nimport \"artalk/dist/Artalk.css\";\nimport \"../styles/artalk.scss\";\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Artalk\",\n\n  props: {\n    /**\n     * The path of the comment\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const artalkOptions = useArtalkOptions();\n    const page = usePageData();\n    const site = useSiteData();\n\n    const loaded = ref(false);\n    const artalkContainer = shallowRef<HTMLDivElement>();\n\n    let artalk: Artalk | null = null;\n\n    const enableArtalk = isString(artalkOptions.server);\n\n    const initArtalk = async (): Promise<void> => {\n      const [{ default: Artalk }] = await Promise.all([\n        import(/* webpackChunkName: \"artalk\" */ \"artalk/dist/Artalk.mjs\"),\n        new Promise<void>((resolve) => {\n          setTimeout(() => {\n            resolve();\n          }, artalkOptions.delay || 800);\n        }),\n      ]);\n\n      loaded.value = true;\n      await nextTick();\n\n      artalk = Artalk.init({\n        useBackendConf: false,\n        site: site.value.title,\n        pageTitle: page.value.title,\n        ...artalkOptions,\n        el: artalkContainer.value!,\n        pageKey: props.identifier,\n        darkMode: props.darkmode,\n      });\n\n      if (artalkOptions.useBackendConf)\n        artalk.on(\"mounted\", () => {\n          artalk!.setDarkMode(props.darkmode);\n        });\n    };\n\n    const updateArtalk = (): void => {\n      artalk!.update({\n        site: site.value.title,\n        pageTitle: page.value.title,\n        pageKey: props.identifier,\n      });\n      artalk!.reload();\n    };\n\n    onMounted(() => {\n      void initArtalk();\n\n      watch(\n        () => props.identifier,\n        () => {\n          if (artalk) void nextTick().then(() => updateArtalk());\n        },\n      );\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value);\n        },\n      );\n    });\n\n    onUnmounted(() => {\n      artalk?.destroy();\n    });\n\n    return (): VNode | null =>\n      enableArtalk\n        ? h(\"div\", { class: \"artalk-wrapper\" }, [\n            loaded.value ? null : h(LoadingIcon),\n            h(\"div\", { ref: artalkContainer }),\n          ])\n        : null;\n  },\n});\n"],"names":["Artalk","defineComponent","props","artalkOptions","useArtalkOptions","page","usePageData","site","useSiteData","loaded","ref","artalkContainer","shallowRef","artalk","enableArtalk","isString","initArtalk","resolve","nextTick","updateArtalk","onMounted","watch","value","onUnmounted","h","LoadingIcon"],"mappings":"4YAqBA,IAAAA,EAAeC,EAAgB,CAE7B,KAAM,SAEN,MAAO,CAIL,WAAY,CACV,KAAM,OACN,SAAU,EACZ,EAOA,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,EAChBC,EAAAA,EAAOC,EAAY,EACnBC,EAAOC,IAEPC,EAASC,EAAI,EAAK,EAClBC,EAAkBC,EAA2B,EAEnD,IAAIC,EAAwB,KAE5B,MAAMC,EAAeC,EAASZ,EAAc,MAAM,EAE5Ca,EAAa,SAA2B,CAC5C,KAAM,CAAC,CAAE,QAAShB,CAAO,CAAC,EAAI,MAAM,QAAQ,IAAI,CAC9C,OAAwC,wBAAwB,EAChE,IAAI,QAAeiB,GAAY,CAC7B,WAAW,IAAM,CACfA,GACF,EAAGd,EAAc,OAAS,GAAG,CAC/B,CAAC,CACH,CAAC,EAEDM,EAAO,MAAQ,GACf,MAAMS,IAENL,EAASb,EAAO,KAAK,CACnB,eAAgB,GAChB,KAAMO,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,GAAGF,EACH,GAAIQ,EAAgB,MACpB,QAAST,EAAM,WACf,SAAUA,EAAM,QAClB,CAAC,EAEGC,EAAc,gBAChBU,EAAO,GAAG,UAAW,IAAM,CACzBA,EAAQ,YAAYX,EAAM,QAAQ,CACpC,CAAC,CACL,EAEMiB,EAAe,IAAY,CAC/BN,EAAQ,OAAO,CACb,KAAMN,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,QAASH,EAAM,UACjB,CAAC,EACDW,EAAQ,OAAA,CACV,EAEA,OAAAO,EAAU,IAAM,CACTJ,EAAAA,EAELK,EACE,IAAMnB,EAAM,WACZ,IAAM,CACAW,GAAaK,EAAS,EAAE,KAAK,IAAMC,EAAa,CAAC,CACvD,CACF,EAEAE,EACE,IAAMnB,EAAM,SACXoB,GAAU,CACTT,GAAQ,YAAYS,CAAK,CAC3B,CACF,CACF,CAAC,EAEDC,EAAY,IAAM,CAChBV,GAAQ,QACV,CAAA,CAAC,EAEM,IACLC,EACIU,EAAE,MAAO,CAAE,MAAO,gBAAiB,EAAG,CACpCf,EAAO,MAAQ,KAAOe,EAAEC,CAAW,EACnCD,EAAE,MAAO,CAAE,IAAKb,CAAgB,CAAC,CACnC,CAAC,EACD,IACR,CACF,CAAC"}